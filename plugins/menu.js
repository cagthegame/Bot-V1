/**
</> Original base BochilGaming 
</> Recode simple by @NeKosmic
**/

import db from"../lib/database.js";import{promises}from"fs";import{join}from"path";import{xpRange}from"../lib/levelling.js";import{plugins}from"../lib/plugins.js";import fetch from"node-fetch";import*as fs from"fs";const tags={conversor:"_CONVERSORES :_",animeuwu:"_ANIME :_",casual:"_CMDS-CASUAL :_",propietario:"_CMDS DUEÑO :_",herramienta:"_HERRAMIENTAS :_",premium:"_PREMIUM :_",avanzado:"_AVANZADO :_",admins:"_CMDS ADMINS :_",grupos:"_CMDS GRUPOS :_",fabricar:"_ARTE Y DISEÑO :_",busqueda:"_BUSQUEDA :_",servicio:"_SERVICIOS :_",xp:"_XP & LIMITE :_",games:"_RPG, JUEGOS :_",random:"_PASATIEMPO :_",esclabot:"_SER SUB-BOT :_","":"_OTROS :_"};let handler=async(e,{conn:t,usedPrefix:a,__dirname:r,command:i,isPrems:n})=>{try{const a=await fetch("https://pastebin.com/raw/GZ8d1qcT"),r=await t.profilePictureUrl(e.sender,"image").catch((e=>"./multimedia/imagenes/avatar_contact.png"));var o=await a.json(),m=o.nk_media||r,l=o.nk_txt}catch(e){m=await t.profilePictureUrl(t.user.jid,"image").catch((e=>"./multimedia/imagenes/avatar_contact.png")),l=""}const s=e.reply(`_Cargando menu..._ ${l}`);await s;try{const i=JSON.parse(await promises.readFile(join(r,"../package.json")).catch((e=>({}))))||{},{exp:o,level:l,role:s}=db.data.users[e.sender],p=n?"Si":"No",d=n?"∞":db.data.users[e.sender].limit,{min:u,xp:c,max:g}=xpRange(l,global.multiplier),f=await t.getName(e.sender),b=timeString(process.uptime()),_=Object.keys(db.data.users).length,h=Object.values(db.data.users).filter((e=>1==e.registered)).length,x=Object.values(plugins).filter((e=>!e.disabled)).map((e=>({help:Array.isArray(e.tags)?e.help:[e.help],tags:Array.isArray(e.tags)?e.tags:[e.tags],prefix:"customPrefix"in e,limit:e.limit,premium:e.premium,enabled:!e.disabled})));for(let e of x)if(e&&"tags"in e)for(let t of e.tags)!(t in tags)&&t&&(tags[t]=t);t.menu=t.menu?t.menu:{};const y=t.menu.before||defaultMenu.before,j=t.menu.header||defaultMenu.header,O=t.menu.body||defaultMenu.body,S=t.menu.footer||defaultMenu.footer,M=t.menu.after||(t.user.jid==t.user.jid?"":`By https://wa.me/${t.user.jid.split`@`[0]}`)+defaultMenu.after,P=[y,...Object.keys(tags).map((e=>j.replace(/%category/g,tags[e])+"\n"+[...x.filter((t=>t.tags&&t.tags.includes(e)&&t.help)).map((e=>e.help.map((t=>O.replace(/%cmd/g,e.prefix?t:"%p"+t).replace(/%islimit/g,e.limit?"(Limitado)":"").replace(/%isPremium/g,e.premium?"(Premium)":"").trim())).join("\n"))),S].join("\n"))),M].join("\n");let A="string"==typeof t.menu?t.menu:"object"==typeof t.menu?P:"";const R={"%":"%",p:a,uptime:b,me:t.getName(t.user.jid),npmname:i.name,npmdesc:i.description,version:i.version,exp:o-u,maxexp:c,totalexp:o,xp4levelup:g-o,prop:global.Propietario,pref:" "+global.Prefijo+" ",github:i.homepage?i.homepage.url||i.homepage:"[ URL de github inválido ]",level:l,name:f,totalreg:_,rtotalreg:h,role:s,prem:p,limit:d,readmore:readMore};A=A.replace(new RegExp(`%(${Object.keys(R).sort(((e,t)=>t.length-e.length)).join`|`})`,"g"),((e,t)=>""+R[t])),await t.sendMessage(e.chat,{image:{url:m},caption:A.trim(),footer:`\n┏⊱ ${NombreDelBot}\n┗━⊱ ${MultiNK.Habla()} ✓`,buttons:[{buttonId:Prefijo+"apoyo",buttonText:{displayText:"[ APOYO ]"},type:1},{buttonId:Prefijo+"creador",buttonText:{displayText:"[ CREADOR ]"},type:1},{buttonId:Prefijo+"informacion",buttonText:{displayText:"[ INFORMACION ]"},type:1}],headerType:4,contextInfo:{mentionedJid:[e.sender],externalAdReply:{thumbnail:fs.readFileSync("./multimedia/imagenes/logo.jpg"),sourceUrl:"https://gitlab.com/NeKosmic/nk-bot-md/-/forks/new"}}},{quoted:e})}catch(a){throw t.reply(e.chat,"[ ! ] Ocurrio un error en el menú :/ ",e),a}};const defaultMenu={before:"\n\n╔I [ ```%npmname``` ]\n║❂ Base de datos: %rtotalreg a %totalreg\n║❂ Tiempo activo: %uptime\n║❂ Version del bot: %version\n║❂ Dueño del bot: CRIS OFC\n║❂ Prefijo único: 「 %pref 」\n║❂ Cliente: %name\n║❂ Premium: %prem\n║❂ Limite restante: %limit\n║❂ Nivel: %level (%exp / %maxexp)\n║❂ Rol: %role\n║❂ XP: %totalexp\n╚══════════\n%readmore\n~|-------------------------|~\n*[_>] _COMANDOS_  ☷*\n~|-------------------------|~\n".trimStart(),header:"╔「 %category 」\n║╭—————————",body:"║├  %cmd %islimit %isPremium",footer:"║╰—————————\n╚══════════\n",after:""};handler.help=["menucompleto","menuprincipal"],handler.command=/^(menucompleto|menuprincipal)$/i,handler.exp=10;export default handler;const more=String.fromCharCode(8206),readMore=more.repeat(850);

/**
[_>] https://github.com/NeKosmic/
[_>] https://gitlab.com/NeKosmic/
**/
